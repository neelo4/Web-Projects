import { type BrandDataProps, connectIagBrand } from '@iag-common/iag-brand-context';
import { dispatchTrackingEventToDocument } from '@iag-common/mfe-global-events';
import { GlobalEventsContext } from '@iag-common/mfe-global-events-context';
import { addDays } from 'date-fns';
import { get } from 'lodash';
import type React from 'react';
import { useContext, useState } from 'react';
import NavigationLink from '../../../components/shared/NavigationLink';
import { FeatureName, useFeaturesConfig } from '../../../../../features-config';
import { formatDate, parseZonedDate } from '../../../../../shared/utils/dateUtils';
import { useBrandUtils } from '../../../../hooks/brand/useBrandUtils';
import type { PolicySummary } from '../../../../models/DashboardDetails';
import { PaymentSummaryStatus } from '../../../../models/PaymentSummaryStatus';
import { PaymentType } from '../../../../models/PaymentType';
import {
  PolicyStatus,
  PolicyStatusOrder,
  findBoundRenewalAfterEffectiveDate,
  findEqualOrAfterChangeEffectiveDate,
  findOverdueRenewal,
  findRenewalPaidBeforeEffectiveDate,
  findUnpaidFutureRenewalPolicy,
  isCoexistencePolicy,
  isCtpNSWPolicy,
  isDateWithinSevenDays,
  isFutureDatedCancellation,
  isInactiveNSW,
  isMigratedPolicy,
  isMigratedRenewalPolicy,
  isOverDueRenewals,
  isPaidMigratedTermPolicy,
  isPolicyChangeRenewal,
  isPolicyInactive,
  isSupportedRenewalProductType,
  isUnpaid,
} from '../../../../models/PolicyStatus';
import PayLaterModal from '../../PayLaterModal';
import PolicyNotification from './PolicyNotification';
import { Link } from '@iag/chroma-react-ui.components';

export type Props = {
  policy: PolicySummary;
};

const PolicyStatusNotification: React.FC<Props & BrandDataProps> = ({ t, tt, tExists, policy }) => {
  const [showNumber, setShowNumber] = useState(false);
  const globalEventsContext = useContext(GlobalEventsContext);
  const element = 'callUs';

  const onShowNumberClick = (e: React.ChangeEvent<HTMLSelectElement>) => {
    e.preventDefault();
    setShowNumber(true);
    const number = `${tt('constants.phoneNumbers.generalEnquiries')}`;

    dispatchTrackingEventToDocument(globalEventsContext, {
      pageName: '/contact-us',
      interaction: 'click',
      element: {
        name: 'personal-contact-us',
        type: 'link',
        value: number.replaceAll(' ', '-'),
      },
    });
  };

  const renderPhoneNavigationLink = () => {
    return (
      <NavigationLink
        to={tt(`pages.contactUs.${element}.link`)}
        dataTestid={element + '.linkToAction1'}
        trackingName="personal-contact-us"
        newWindow={false}
        onClick={(e: React.ChangeEvent<HTMLSelectElement>) => onShowNumberClick(e)}
        isInternalLink={true}
      >
        {tt('constants.phoneNumbers.generalEnquiries')}
      </NavigationLink>
    );
  };

  const renderShowNumberLinkLabel = () => {
    return (
      <div data-testid={element + '.linkToAction1'}>
        {`${tt('constants.phoneNumbers.maskGeneralEnquiries')} `}
        <Link onClick={onShowNumberClick}>{tt('pages.contactUs.callUs.showNumberText')}</Link>
      </div>
    );
  };

  if (showMissedInstalment) {
    return (
      <PolicyNotification
        type="warning"
        label={tt('labels.missedInstalment')}
        subtext={
          <>
            {t(getFullBrandStringNameByUserType('labels.missedInstalmentSubtext'))}{' '}
            {showNumber ? renderPhoneNavigationLink() : renderShowNumberLinkLabel()}
          </>
        }
      />
    );
  }

  // ... (rest of the existing code remains unchanged)

  return <></>;
};

export default connectIagBrand()(PolicyStatusNotification);
