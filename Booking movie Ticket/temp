import React, { useState } from 'react';
import { trackingEventWrapper } from '../../../utils/trackingEventWrapper';
import { useContext } from '../../../utils/SiteTrackingContext';
import { ActionName, ElementType, Interaction } from '../../../models/tracking';

type ShowPhoneNumberProps = {
  maskedNumber: string;
  unmaskedNumber: string;
};

const ShowPhoneNumber: React.FC<ShowPhoneNumberProps> = ({ maskedNumber, unmaskedNumber }) => {
  const [isVisible, setIsVisible] = useState(false);
  const [showLink, setShowLink] = useState(true);
  const trackingEventContext = useContext(SiteTrackingContext);

  const handleShowNumber = (e: React.MouseEvent) => {
    e.preventDefault();
    setIsVisible(true);
    setShowLink(false);

    // Track show number click
    trackingEventWrapper({
      ...trackingEventContext,
      details: {
        interaction: Interaction.CLICK,
        element: {
          name: ActionName.SHOW_NUMBER,
          type: ElementType.LINK,
          value: 'show-number'
        }
      }
    })();
  };

  const handleNumberClick = (e: React.MouseEvent) => {
    // Track number click
    trackingEventWrapper({
      ...trackingEventContext,
      details: {
        interaction: Interaction.CLICK,
        element: {
          name: ActionName.CALL_US,
          type: ElementType.LINK,
          value: unmaskedNumber.replace(/\s/g, '-')
        }
      }
    })();
  };

  return (
    <span style={{ display: 'inline' }}>
      {isVisible ? (
        <a 
          href={`tel:${unmaskedNumber.replace(/\s/g, '')}`} 
          className="text-blue-600 underline"
          onClick={handleNumberClick}
        >
          {unmaskedNumber}
        </a>
      ) : (
        <>
          <span className="text-blue-600">{maskedNumber}</span>
          {showLink && (
            <button
              onClick={handleShowNumber}
              className="ml-1 text-blue-600 hover:text-blue-800 text-sm underline focus:outline-none"
              style={{ verticalAlign: 'baseline' }}
            >
              Show number
            </button>
          )}
        </>
      )}
    </span>
  );
};

export default ShowPhoneNumber;
