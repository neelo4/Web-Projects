describe('Test greeting component for NRMA with customerSinceDate', () => {
  const policies: PolicySummary[] = [];
  const baseUserData = {
    fullName: 'Tester',
    firstName: 'Tester',
    isStaffMember: false,
    email: 'jdisney@disney.com.au',
    policies: policies,
    preferredName: '',
  };

  const featureFlagMocks = {
    SHOW_CUSTOMER_SINCE_BADGE: true,
    COMPONENT_STYLE_BANNER_BG_COLOR: 'bg-white'
  };

  beforeEach(() => {
    jest.clearAllMocks();
    window.__CLIENT_VARS__.brand = Brand.NRMA;
    
    (useFeaturesConfig as jest.Mock).mockImplementation((featureName: keyof typeof featureFlagMocks) => {
      return featureFlagMocks[featureName];
    });
  });

  test('renders customer since badge when customerSinceDate is available', () => {
    const userData = {
      ...baseUserData,
      customerSinceDate: '2020-01-01'
    };

    render(
      <AppContext.Provider value={{ appState: {}, setAppState: jest.fn() }}>
        <HomeDetailsContext.Provider value={userData}>
          <Greeting />
        </HomeDetailsContext.Provider>
      </AppContext.Provider>
    );

    expect(screen.getByText(/Customer since 2020/)).toBeInTheDocument();
    expect(screen.getByText('Hi Tester')).toBeInTheDocument();
  });

  test('does not render customer since badge when customerSinceDate is undefined', () => {
    const userData = {
      ...baseUserData,
      customerSinceDate: undefined
    };

    render(
      <AppContext.Provider value={{ appState: {}, setAppState: jest.fn() }}>
        <HomeDetailsContext.Provider value={userData}>
          <Greeting />
        </HomeDetailsContext.Provider>
      </AppContext.Provider>
    );

    expect(screen.queryByText(/Customer since/)).not.toBeInTheDocument();
    expect(screen.getByText('Hi Tester')).toBeInTheDocument();
  });

  test('does not render customer since badge when feature flag is disabled', () => {
    const userData = {
      ...baseUserData,
      customerSinceDate: '2020-01-01'
    };

    // Override feature flag to be false
    (useFeaturesConfig as jest.Mock).mockImplementation((featureName: string) => {
      if (featureName === 'SHOW_CUSTOMER_SINCE_BADGE') return false;
      return featureFlagMocks[featureName];
    });

    render(
      <AppContext.Provider value={{ appState: {}, setAppState: jest.fn() }}>
        <HomeDetailsContext.Provider value={userData}>
          <Greeting />
        </HomeDetailsContext.Provider>
      </AppContext.Provider>
    );

    expect(screen.queryByText(/Customer since/)).not.toBeInTheDocument();
    expect(screen.getByText('Hi Tester')).toBeInTheDocument();
  });
});
