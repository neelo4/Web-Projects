import { BrandDataProps, connectIagBrand } from '@iag-common/iag-brand-context';
import { Badge } from '@iag/chroma-react-ui.badge';
import { Container } from '@iag/chroma-react-ui.container';
import { Icon } from '@iag/chroma-react-ui.icon';
import React, { useContext } from 'react';
import { HomeDetailsContext } from '../../pages/HomeContainer';
import { FeatureName, useFeaturesConfig } from './../../features-config';

const Greeting: React.FC<BrandDataProps> = ({ tExists, tt }) => {
  const { staffNumber, preferredName, firstName, customerSinceDate } = useContext(HomeDetailsContext);
  const hideIndividualDetails = useFeaturesConfig(FeatureName.HIDE_INDIVIDUAL_DETAILS);
  const bannerBackgroundColor = useFeaturesConfig(FeatureName.COMPONENT_STYLE_BANNER_BG_COLOR);
  const customerSinceDetails = useFeaturesConfig(FeatureName.SHOW_CUSTOMER_SINCE_BADGE);

  const textClassName = tExists('constants.colors.greetingTextColor')
    ? `text-${tt('constants.colors.greetingTextColor')}`
    : `text-${tt('constants.colors.bannerTextColor')}`;

  const getGreetingTitle = () => {
    if (hideIndividualDetails) {
      return tt('pages.home.greeting');
    }

    return tt('pages.home.greeting') + (preferredName == '' ? firstName : preferredName);
  };
  const formatCustomerSinceDate = (date: string | undefined) => {
    if (!date) return '';
    return date.split('-')[0] || '';
  };
  return (
    <div className={`${bannerBackgroundColor}`}>
      <Container className="py-10 px-4">
        <div className="max-w-full mx-auto flex flex-col gap-2">
          <h1 className={`${textClassName} font-bold text-[32px]`} data-testid="page-title">
            {getGreetingTitle()}
          </h1>
          <p className={`${textClassName} mb-0`}>{tt('pages.home.greetingMessage')}</p>
          <div className="flex gap-2">
            {staffNumber && (
              <Badge
                className={`w-fit px-3 py-1.5 gap-2 mt-3 items-center bg-${tt(
                  'constants.colors.staffBadgeBgColor',
                )} text-${tt('constants.colors.staffBadgeColor')}`}
              >
                <Icon className={`i-user-circle text-base`} />
                {tt('pages.home.staffBadge')}
              </Badge>
            )}
            {customerSinceDetails && (
              <Badge
                className={`w-fit px-3 py-1.5 gap-2 mt-3 items-center bg-${tt(
                  'constants.colors.customerSinceBadgeBgColor',
                )} text-${tt('constants.colors.customerSinceBadgeTextColor')}`}
              >
                {!staffNumber && <Icon className={`i-user-circle text-base`} />}

                {`${tt('pages.home.customerSinceBadge')}  ${formatCustomerSinceDate(customerSinceDate)}`}
              </Badge>
            )}
          </div>
        </div>
      </Container>
    </div>
  );
};

export default connectIagBrand()(Greeting);
